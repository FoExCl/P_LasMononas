{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>{% if form.instance.pk %}Editar Caja{% else %}Nueva Caja{% endif %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-4">
    <div class="title-box text-center mb-3">
        <h1>{% if form.instance.pk %}‚úèÔ∏è Editar Caja{% else %}‚ûï Nueva Caja{% endif %}</h1>
    </div>

    <form method="post" id="cajaForm"
          action="{% if form.instance.pk %}{% url 'editar_caja' form.instance.pk %}{% else %}{% url 'crear_caja' %}{% endif %}">
        {% csrf_token %}
        {% if form.non_field_errors %}
    <div class="alert alert-danger">
        {% for error in form.non_field_errors %}
            <p>{{ error }}</p>
        {% endfor %}
    </div>
{% endif %}

{% for field in form %}
    {% if field.errors %}
        <div class="alert alert-danger">
            {{ field.label }}: {{ field.errors|striptags }}
        </div>
    {% endif %}
{% endfor %}

        <div class="mb-3">
            <label for="id_ubicacion">Ubicaci√≥n</label>
            {{ form.ubicacion }}
        </div>

        <div class="mb-3">
            <label for="id_estado">Estado</label>
            {{ form.estado }}
        </div>

        {{ form.id_sucursal }}

        <div class="d-flex justify-content-between">
            <a href="{% url 'lista_cajas' %}" class="btn btn-secondary">‚¨ÖÔ∏è Volver</a>
            <button type="submit" class="btn btn-primary">üíæ Guardar</button>
        </div>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const ubicacionField = document.getElementById("id_ubicacion");
    const sucursalField = document.getElementById("id_sucursal");
    const form = document.getElementById("cajaForm");

    function actualizarSucursal() {
        switch (ubicacionField.value) {
            case "Monona, zn oeste":
                sucursalField.value = 1;
                break;
            case "Monona, zn norte":
                sucursalField.value = 2;
                break;
            default:
                sucursalField.value = ""; // si no coincide
        }
    }

    // Inicializar al cargar
    actualizarSucursal();

    // Cada vez que cambia la ubicaci√≥n
    ubicacionField.addEventListener("change", actualizarSucursal);

    // Antes de enviar el formulario
    form.addEventListener("submit", function(e) {
        actualizarSucursal(); // asegurar valor actualizado
        if (!sucursalField.value) {
            e.preventDefault(); // prevenir env√≠o si no hay sucursal
            alert("Debes seleccionar una ubicaci√≥n v√°lida para asignar la sucursal.");
        }
    });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
